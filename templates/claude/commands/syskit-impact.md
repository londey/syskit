---
description: Analyze impact of a proposed change across all specifications
arguments:
  - name: change
    description: Description of the proposed change
    required: true
---

# Impact Analysis

You are analyzing the impact of a proposed change on this project's specifications.

## Proposed Change

$ARGUMENTS.change

## Instructions

### Step 1: Read Manifest

Read `.syskit/manifest.md` to get the current list of all specification documents and their hashes.

Count the total number of specification documents listed (excluding any with `_000_template` in the name). You will use this count to validate the subagent's output.

### Step 2: Delegate Document Analysis

Use the Task tool to launch a subagent that reads and analyzes all specification documents. This keeps the full document contents out of your context window.

Launch a `general-purpose` Task agent with this prompt (substitute the actual proposed change for PROPOSED_CHANGE below):

> You are analyzing the impact of a proposed change on specification documents.
>
> ## Proposed Change
>
> PROPOSED_CHANGE
>
> ## Instructions
>
> 1. Read ALL markdown files in these directories:
>    - `doc/requirements/`
>    - `doc/interfaces/`
>    - `doc/design/`
>
>    Skip any files with `_000_template` in the name.
>
> 2. For each document, extract:
>    - The document ID (from the H1 heading, e.g., "REQ-001", "INT-003", "UNIT-007")
>    - The document title (from the H1 heading after the ID)
>    - All cross-references to other documents (REQ-NNN, INT-NNN, UNIT-NNN mentions)
>    - A brief summary of what the document specifies (1-2 sentences)
>
> 3. Analyze each document against the proposed change. Categorize as:
>    - **DIRECT**: The document itself describes something being changed
>    - **INTERFACE**: The document defines or uses an interface affected by the change
>    - **DEPENDENT**: The document depends on something being changed (via REQ/INT/UNIT references to a DIRECT or INTERFACE document)
>    - **UNAFFECTED**: The document is not impacted
>
>    When tracing dependencies:
>    - If a requirement is DIRECT, check which design units have it in "Implements Requirements" (those are DEPENDENT)
>    - If a requirement is DIRECT, check which interfaces it lists under "Interfaces" (those are INTERFACE)
>    - If an interface is DIRECT or INTERFACE, check which units list it under "Provides" or "Consumes" (those are DEPENDENT)
>    - If a design unit is DIRECT, check which requirements it implements (review for DEPENDENT impact)
>
> 4. Return your analysis in EXACTLY this structured format:
>
> IMPACT_ANALYSIS_START
>
> ## Direct Impacts
>
> ### filename
> - **ID:** REQ/INT/UNIT-NNN
> - **Title:** document title
> - **Impact:** what specifically is affected, 1-2 sentences
> - **Action Required:** modify/review/no change
> - **Key References:** cross-referenced IDs found in this document
>
> ## Interface Impacts
>
> ### filename
> - **ID:** INT-NNN
> - **Title:** document title
> - **Impact:** what specifically is affected
> - **Consumers:** UNIT-NNN that consume this interface
> - **Providers:** UNIT-NNN that provide this interface
> - **Action Required:** modify/review/no change
>
> ## Dependent Impacts
>
> ### filename
> - **ID:** REQ/INT/UNIT-NNN
> - **Title:** document title
> - **Dependency:** what it depends on that is changing, with specific ID
> - **Impact:** what specifically is affected
> - **Action Required:** modify/review/no change
>
> ## Unaffected Documents
>
> | Document | ID | Reason Unaffected |
> |----------|-----|-------------------|
> | filename | ID | brief reason |
>
> ## Summary
>
> - **Total Documents:** n
> - **Directly Affected:** n
> - **Interface Affected:** n
> - **Dependently Affected:** n
> - **Unaffected:** n
>
> IMPACT_ANALYSIS_END
>
> If a category has no documents, include the heading with "None." underneath.

### Step 3: Validate Analysis

After the subagent returns:

1. Extract the structured analysis between the `IMPACT_ANALYSIS_START` and `IMPACT_ANALYSIS_END` markers
2. Compare the "Total Documents" count from the subagent's summary against the count you computed from the manifest in Step 1
3. If any documents are missing from the analysis, list them and warn the user
4. If the subagent failed or returned incomplete results, tell the user and offer to fall back to direct analysis (read all documents yourself)

### Step 4: Create Analysis Folder

Create `.syskit/analysis/{{DATE}}_<change_name>/` with:

1. `impact.md` — The impact report (format below)
2. `snapshot.md` — Generated by running: `.syskit/scripts/manifest-snapshot.sh .syskit/analysis/{{DATE}}_<change_name>/`

### Step 5: Output Impact Report

Use the subagent's structured analysis to write `impact.md` in this format:

```markdown
# Impact Analysis: <brief change summary>

Created: <timestamp>
Status: Pending Review

## Proposed Change

<detailed description of the change>

## Direct Impacts

### <filename>
- **ID:** <REQ/INT/UNIT-NNN>
- **Impact:** <what specifically is affected>
- **Action Required:** <modify/review/no change>

## Interface Impacts

### <filename>
- **ID:** <INT-NNN>
- **Impact:** <what specifically is affected>
- **Consumers:** <list of units that consume this interface>
- **Providers:** <list of units that provide this interface>
- **Action Required:** <modify/review/no change>

## Dependent Impacts

### <filename>
- **ID:** <REQ/INT/UNIT-NNN>
- **Dependency:** <what it depends on that is changing>
- **Impact:** <what specifically is affected>
- **Action Required:** <modify/review/no change>

## Unaffected Documents

| Document | ID | Reason Unaffected |
|----------|-----|-------------------|
| <filename> | <ID> | <brief reason> |

## Summary

- **Total Documents:** <n>
- **Directly Affected:** <n>
- **Interface Affected:** <n>
- **Dependently Affected:** <n>
- **Unaffected:** <n>

## Recommended Next Steps

1. <first action>
2. <second action>
...
```

### Step 6: Next Step

After presenting the impact report, tell the user:

"Impact analysis complete. Results saved to `.syskit/analysis/<folder>/impact.md`.

Next step: run `/syskit-propose` to propose specific changes to the affected documents.

Tip: Start a new conversation before running the next command to free up context."
