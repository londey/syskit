---
description: Create implementation task breakdown from approved specification changes
arguments:
  - name: analysis
    description: Name of the analysis folder (optional, uses most recent if not specified)
    required: false
---

# Plan Implementation Tasks

You are creating an implementation task breakdown based on approved specification changes.

## Instructions

### Step 1: Load Approved Changes

If `$ARGUMENTS.analysis` is provided:
- Load `.syskit/analysis/$ARGUMENTS.analysis/proposed_changes.md`

Otherwise:
- Find the most recent folder in `.syskit/analysis/`
- Load `proposed_changes.md` from that folder

Verify the status shows changes were approved. If not, prompt user to run `/syskit-propose` first.

### Step 2: Delegate Scope Extraction

Use the Task tool to launch a subagent that reads the affected documents and design units to extract implementation scope. This keeps the full document contents out of your context window.

Launch a `general-purpose` Task agent with this prompt (substitute the actual proposed_changes.md content for PROPOSED_CHANGES_CONTENT below):

> You are extracting implementation scope from approved specification changes.
>
> ## Proposed Changes
>
> PROPOSED_CHANGES_CONTENT
>
> ## Instructions
>
> 1. Read each specification document referenced in the proposed changes above. Read them from the `doc/` directories.
>
> 2. Read all design unit documents (`doc/design/unit_*.md`) to understand implementation structure. Focus especially on:
>    - The `## Implementation` section (lists source files)
>    - The `## Implements Requirements` section (links to REQ-NNN)
>    - The `## Provides` and `## Consumes` sections (links to INT-NNN)
>
> 3. For each specification change in the proposed changes, identify:
>    - Which source files need modification (from design unit Implementation sections)
>    - Which test files need modification or creation
>    - Dependencies between changes (what must be done first)
>    - How to verify the change was implemented correctly
>
> 4. Return your analysis in EXACTLY this structured format:
>
> SCOPE_ANALYSIS_START
>
> ## Implementation Scope
>
> ### Change: brief description of first change
>
> **Affected Specs:** REQ-NNN, INT-NNN, UNIT-NNN
> **Source Files to Modify:**
> - `path/to/file`: what needs to change
>
> **Source Files to Create:**
> - `path/to/file`: purpose
>
> **Test Files:**
> - `path/to/test`: what to test
>
> **Dependencies:** description of what must be done first, or "None"
> **Verification:** how to verify this change
>
> ### Change: brief description of next change
>
> (repeat for each distinct change)
>
> ## Suggested Task Sequence
>
> | # | Task | Dependencies | Est. Effort |
> |---|------|--------------|-------------|
> | 1 | task name | None | small/medium/large |
> | 2 | task name | Task 1 | effort |
>
> ## Risks and Considerations
>
> - risk or consideration
>
> SCOPE_ANALYSIS_END

### Step 3: Review Scope Analysis

After the subagent returns:

1. Extract the content between the `SCOPE_ANALYSIS_START` and `SCOPE_ANALYSIS_END` markers
2. Review for completeness — ensure all changes from proposed_changes.md are covered
3. Review the suggested task sequence for logical ordering and dependencies
4. If the subagent failed or returned incomplete results, tell the user and offer to fall back to direct analysis

### Step 4: Create Task Folder

Create `.syskit/tasks/<date>_<change_name>/` with:

1. `plan.md` — Overall implementation strategy
2. `snapshot.md` — Generated by running: `.syskit/scripts/manifest-snapshot.sh .syskit/tasks/<date>_<change_name>/`
3. `task_001_<n>.md` through `task_NNN_<n>.md` — Individual tasks

### Step 5: Write Implementation Plan

Create `plan.md` using the agent's scope analysis:

```markdown
# Implementation Plan: <change name>

Based on: ../.syskit/analysis/<folder>/proposed_changes.md
Created: <timestamp>
Status: In Progress

## Overview

<Brief description of what is being implemented>

## Specification Changes Applied

| Document | Change Type | Summary |
|----------|-------------|---------|
| <doc> | Modified | <summary> |

## Implementation Strategy

<High-level approach to implementing these changes>

## Task Sequence

| # | Task | Dependencies | Est. Effort |
|---|------|--------------|-------------|
| 1 | <task name> | None | <small/medium/large> |
| 2 | <task name> | Task 1 | <effort> |

## Verification Approach

<How we will verify the implementation meets the specifications>

## Risks and Considerations

- <risk or consideration>
```

### Step 6: Write Individual Tasks

For each task, create `task_NNN_<n>.md`:

```markdown
# Task NNN: <task name>

Status: Pending
Dependencies: <list or "None">
Specification References: <REQ-NNN, INT-NNN, UNIT-NNN>

## Objective

<What this task accomplishes>

## Files to Modify

- `<filepath>`: <what changes>
- `<filepath>`: <what changes>

## Files to Create

- `<filepath>`: <purpose>

## Implementation Steps

1. <step>
2. <step>
3. <step>

## Verification

- [ ] <verification criterion>
- [ ] <verification criterion>

## Notes

<Any additional context or considerations>
```

### Step 7: Present Plan

Output the implementation plan summary and tell the user:

"Implementation plan created with <n> tasks in `.syskit/tasks/<folder>/`.

Next step: run `/syskit-implement` to begin working through the tasks.

Tip: Start a new conversation before running the next command to free up context."
